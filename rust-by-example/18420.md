::: sidebar-scrollbox
1.  [Introduction](../../index.html)

2.  [**1.** Hello World](../../hello.html)[]{.toggle}

    <div>

    ❱

    </div>

3.  1.  [**1.1.** コメント](../../hello/comment.html)

    2.  [**1.2.**
        フォーマットしてプリント](../../hello/print.html)[]{.toggle}

        <div>

        ❱

        </div>

    3.  1.  [**1.2.1.** デバッグ](../../hello/print/print_debug.html)

        2.  [**1.2.2.**
            ディスプレイ](../../hello/print/print_display.html)[]{.toggle}

            <div>

            ❱

            </div>

        3.  1.  [**1.2.2.1.** テストケース:
                リスト](../../hello/print/print_display/testcase_list.html)

        4.  [**1.2.3.** フォーマット](../../hello/print/fmt.html)

4.  [**2.** 基本データ型](../../primitives.html)[]{.toggle}

    <div>

    ❱

    </div>

5.  1.  [**2.1.** リテラルとオペレータ](../../primitives/literals.html)
    2.  [**2.2.** タプル](../../primitives/tuples.html)
    3.  [**2.3.** 配列とスライス](../../primitives/array.html)

6.  [**3.** カスタム型](../../custom_types.html)[]{.toggle}

    <div>

    ❱

    </div>

7.  1.  [**3.1.** 構造体](../../custom_types/structs.html)

    2.  [**3.2.** 列挙型](../../custom_types/enum.html)[]{.toggle}

        <div>

        ❱

        </div>

    3.  1.  [**3.2.1.** use](../../custom_types/enum/enum_use.html)
        2.  [**3.2.2.**
            C言語ライクな列挙型](../../custom_types/enum/c_like.html)
        3.  [**3.2.3.** テストケース:
            連結リスト](../../custom_types/enum/testcase_linked_list.html)

    4.  [**3.3.** 定数](../../custom_types/constants.html)

8.  [**4.** 変数束縛](../../variable_bindings.html)[]{.toggle}

    <div>

    ❱

    </div>

9.  1.  [**4.1.** ミュータビリティ](../../variable_bindings/mut.html)
    2.  [**4.2.**
        スコープとシャドーイング](../../variable_bindings/scope.html)
    3.  [**4.3.** 宣言](../../variable_bindings/declare.html)
    4.  [**4.4.** 値の凍結](../../variable_bindings/freeze.html)

10. [**5.** 型](../../types.html)[]{.toggle}

    <div>

    ❱

    </div>

11. 1.  [**5.1.** 型キャスティング](../../types/cast.html)
    2.  [**5.2.** リテラル](../../types/literals.html)
    3.  [**5.3.** 型推論](../../types/inference.html)
    4.  [**5.4.** エイリアス](../../types/alias.html)

12. [**6.** 型変換](../../conversion.html)[]{.toggle}

    <div>

    ❱

    </div>

13. 1.  [**6.1.** FromおよびInto](../../conversion/from_into.html)
    2.  [**6.2.**
        TryFromおよびTryInto](../../conversion/try_from_try_into.html)
    3.  [**6.3.** Stringとの型変換](../../conversion/string.html)

14. [**7.** 式](../../expression.html)

15. [**8.** 条件分岐](../../flow_control.html)[]{.toggle}

    <div>

    ❱

    </div>

16. 1.  [**8.1.** if/else](../../flow_control/if_else.html)

    2.  [**8.2.** loop](../../flow_control/loop.html)[]{.toggle}

        <div>

        ❱

        </div>

    3.  1.  [**8.2.1.**
            ネストとラベル](../../flow_control/loop/nested.html)
        2.  [**8.2.2.**
            loopが返す値](../../flow_control/loop/return.html)

    4.  [**8.3.** while](../../flow_control/while.html)

    5.  [**8.4.** for と range](../../flow_control/for.html)

    6.  [**8.5.** match](../../flow_control/match.html)[]{.toggle}

        <div>

        ❱

        </div>

    7.  1.  [**8.5.1.**
            デストラクト](../../flow_control/match/destructuring.html)[]{.toggle}

            <div>

            ❱

            </div>

        2.  1.  [**8.5.1.1.**
                タプル](../../flow_control/match/destructuring/destructure_tuple.html)
            2.  [**8.5.1.2.**
                列挙型](../../flow_control/match/destructuring/destructure_enum.html)
            3.  [**8.5.1.3.**
                ポインタとref](../../flow_control/match/destructuring/destructure_pointers.html)
            4.  [**8.5.1.4.**
                構造体](../../flow_control/match/destructuring/destructure_structures.html)

        3.  [**8.5.2.** ガード](../../flow_control/match/guard.html)

        4.  [**8.5.3.**
            バインディング](../../flow_control/match/binding.html)

    8.  [**8.6.** if let](../../flow_control/if_let.html)

    9.  [**8.7.** while let](../../flow_control/while_let.html)

17. [**9.** 関数](../../fn.html)[]{.toggle}

    <div>

    ❱

    </div>

18. 1.  [**9.1.** メソッド](../../fn/methods.html)

    2.  [**9.2.** クロージャ](../../fn/closures.html)[]{.toggle}

        <div>

        ❱

        </div>

    3.  1.  [**9.2.1.** 要素の捕捉](../../fn/closures/capture.html)

        2.  [**9.2.2.**
            捕捉時の型推論](../../fn/closures/input_parameters.html)

        3.  [**9.2.3.**
            クロージャを受け取る関数](../../fn/closures/anonymity.html)

        4.  [**9.2.4.**
            関数を受け取る関数](../../fn/closures/input_functions.html)

        5.  [**9.2.5.**
            クロージャを返す関数](../../fn/closures/output_parameters.html)

        6.  [**9.2.6.**
            stdにおける使用例](../../fn/closures/closure_examples.html)[]{.toggle}

            <div>

            ❱

            </div>

        7.  1.  [**9.2.6.1.**
                Iterator::any](../../fn/closures/closure_examples/iter_any.html)
            2.  [**9.2.6.2.**
                Iterator::find](../../fn/closures/closure_examples/iter_find.html)

    4.  [**9.3.** 高階関数](../../fn/hof.html)

    5.  [**9.4.** Diverging functions](../../fn/diverging.html)

19. [**10.** モジュール](../../mod.html)[]{.toggle}

    <div>

    ❱

    </div>

20. 1.  [**10.1.** プライベートとパブリック](../../mod/visibility.html)
    2.  [**10.2.** 構造体の場合](../../mod/struct_visibility.html)
    3.  [**10.3.** use宣言](../../mod/use.html)
    4.  [**10.4.** super と self](../../mod/super.html)
    5.  [**10.5.** ファイルの階層構造](../../mod/split.html)

21. [**11.** クレート](../../crates.html)[]{.toggle}

    <div>

    ❱

    </div>

22. 1.  [**11.1.** Creating a Library](../../crates/lib.html)
    2.  [**11.2.** Using a Library](../../crates/using_lib.html)

23. [**12.** Cargo](../../cargo.html)[]{.toggle}

    <div>

    ❱

    </div>

24. 1.  [**12.1.** Dependencies](../../cargo/deps.html)
    2.  [**12.2.** Conventions](../../cargo/conventions.html)
    3.  [**12.3.** Tests](../../cargo/test.html)
    4.  [**12.4.** Build Scripts](../../cargo/build_scripts.html)

25. [**13.** アトリビュート](../../attribute.html)[]{.toggle}

    <div>

    ❱

    </div>

26. 1.  [**13.1.** dead_code](../../attribute/unused.html)

    2.  [**13.2.** クレート](../../attribute/crate.html)

    3.  [**13.3.** cfg](../../attribute/cfg.html)[]{.toggle}

        <div>

        ❱

        </div>

    4.  1.  [**13.3.1.** 条件の追加](../../attribute/cfg/custom.html)

27. [**14.** ジェネリクス](../../generics.html)[]{.toggle}

    <div>

    ❱

    </div>

28. 1.  [**14.1.** 関数](../../generics/gen_fn.html)

    2.  [**14.2.** メソッド](../../generics/impl.html)

    3.  [**14.3.** ジェネリックトレイト](../../generics/gen_trait.html)

    4.  [**14.4.**
        ジェネリック境界](../../generics/bounds.html)[]{.toggle}

        <div>

        ❱

        </div>

    5.  1.  [**14.4.1.** テストケース:
            空トレイト](../../generics/bounds/testcase_empty.html)

    6.  [**14.5.**
        複数のジェネリック境界](../../generics/multi_bounds.html)

    7.  [**14.6.** Where句](../../generics/where.html)

    8.  [**14.7.** New Type Idiom](../../generics/new_types.html)

    9.  [**14.8.** 関連型](../../generics/assoc_items.html)[]{.toggle}

        <div>

        ❱

        </div>

    10. 1.  [**14.8.1.**
            関連型が必要になる状況](../../generics/assoc_items/the_problem.html)
        2.  [**14.8.2.** 関連型](../../generics/assoc_items/types.html)

    11. [**14.9.**
        幽霊型パラメータ](../../generics/phantom.html)[]{.toggle}

        <div>

        ❱

        </div>

    12. 1.  [**14.9.1.** テストケース:
            単位を扱う](../../generics/phantom/testcase_units.html)

29. [**15.** スコーピングの規則](../../scope.html)[]{.toggle}

    <div>

    ❱

    </div>

30. 1.  [**15.1.** RAII](../../scope/raii.html)

    2.  [**15.2.** 所有権とムーブ](../../scope/move.html)[]{.toggle}

        <div>

        ❱

        </div>

    3.  1.  [**15.2.1.** ミュータビリティ](../../scope/move/mut.html)
        2.  [**15.2.2.** Partial
            moves](../../scope/move/partial_move.html)

    4.  [**15.3.** 借用](../../scope/borrow.html)[]{.toggle}

        <div>

        ❱

        </div>

    5.  1.  [**15.3.1.** ミュータビリティ](../../scope/borrow/mut.html)
        2.  [**15.3.2.** エイリアス](../../scope/borrow/alias.html)
        3.  [**15.3.3.** refパターン](../../scope/borrow/ref.html)

    6.  [**15.4.** ライフタイム](../../scope/lifetime.html)[]{.toggle}

        <div>

        ❱

        </div>

    7.  1.  [**15.4.1.**
            明示的アノテーション](../../scope/lifetime/explicit.html)
        2.  [**15.4.2.** 関数](../../scope/lifetime/fn.html)
        3.  [**15.4.3.** メソッド](../../scope/lifetime/methods.html)
        4.  [**15.4.4.** 構造体](../../scope/lifetime/struct.html)
        5.  [**15.4.5.** Traits](../../scope/lifetime/trait.html)
        6.  [**15.4.6.**
            ライフタイム境界](../../scope/lifetime/lifetime_bounds.html)
        7.  [**15.4.7.**
            圧縮](../../scope/lifetime/lifetime_coercion.html)
        8.  [**15.4.8.**
            スタティックライフタイム](../../scope/lifetime/static_lifetime.html)
        9.  [**15.4.9.** 省略](../../scope/lifetime/elision.html)

31. [**16.** トレイト](../../trait.html)[]{.toggle}

    <div>

    ❱

    </div>

32. 1.  [**16.1.** 継承(Derive)](../../trait/derive.html)
    2.  [**16.2.** Returning Traits with dyn](../../trait/dyn.html)
    3.  [**16.3.** 演算子のオーバーロード](../../trait/ops.html)
    4.  [**16.4.** メモリ解放](../../trait/drop.html)
    5.  [**16.5.** イテレータ](../../trait/iter.html)
    6.  [**16.6.** impl Trait](../../trait/impl_trait.html)
    7.  [**16.7.** クローン](../../trait/clone.html)
    8.  [**16.8.** Supertraits](../../trait/supertraits.html)
    9.  [**16.9.** Disambiguating overlapping
        traits](../../trait/disambiguating.html)

33. [**17.** macro_rules!](../../macros.html)[]{.toggle}

    <div>

    ❱

    </div>

34. 1.  [**17.1.** 構文](../../macros/syntax.html)[]{.toggle}

        <div>

        ❱

        </div>

    2.  1.  [**17.1.1.** 識別子](../../macros/designators.html)
        2.  [**17.1.2.** オーバーロード](../../macros/overload.html)
        3.  [**17.1.3.** 繰り返し](../../macros/repeat.html)

    3.  [**17.2.** DRY (Don\'t Repeat Yourself)](../../macros/dry.html)

    4.  [**17.3.** Domain Specific Languages
        (ドメイン特化言語、DSLs)](../../macros/dsl.html)

    5.  [**17.4.** 可変個引数](../../macros/variadics.html)

35. [**18.** エラーハンドリング](../../error.html)[]{.toggle}

    <div>

    ❱

    </div>

36. 1.  [**18.1.** panic](../../error/panic.html)

    2.  [**18.2.** Option と
        unwrap](../../error/option_unwrap.html)[]{.toggle}

        <div>

        ❱

        </div>

    3.  1.  [**18.2.1.**
            ?によるOptionのアンパック](../../error/option_unwrap/question_mark.html)
        2.  [**18.2.2.** Combinators:
            map](../../error/option_unwrap/map.html)
        3.  [**18.2.3.** Combinators:
            and_then](../../error/option_unwrap/and_then.html)

    4.  [**18.3.** Result](../../error/result.html)[]{.toggle}

        <div>

        ❱

        </div>

    5.  1.  [**18.3.1.**
            Resultのmap](../../error/result/result_map.html)
        2.  [**18.3.2.**
            Resultに対するエイリアス](../../error/result/result_alias.html)
        3.  [**18.3.3.**
            早期リターン](../../error/result/early_returns.html)
        4.  [**18.3.4.**
            ?の導入](../../error/result/enter_question_mark.html)

    6.  [**18.4.**
        複数のエラー型](../../error/multiple_error_types.html)[]{.toggle}

        <div>

        ❱

        </div>

    7.  1.  [**18.4.1.**
            OptionからResultを取り出す](../../error/multiple_error_types/option_result.html)
        2.  [**18.4.2.**
            エラー型を定義する](../../error/multiple_error_types/define_error_type.html){.active}
        3.  [**18.4.3.**
            エラーをBoxする](../../error/multiple_error_types/boxing_errors.html)
        4.  [**18.4.4.**
            ?の他の活用法](../../error/multiple_error_types/reenter_question_mark.html)
        5.  [**18.4.5.**
            エラーをラップする](../../error/multiple_error_types/wrap_error.html)

    8.  [**18.5.** Resultをイテレートする](../../error/iter_result.html)

37. [**19.** 標準ライブラリの型](../../std.html)[]{.toggle}

    <div>

    ❱

    </div>

38. 1.  [**19.1.** Box, スタックとヒープ](../../std/box.html)

    2.  [**19.2.** ベクタ型](../../std/vec.html)

    3.  [**19.3.** 文字列](../../std/str.html)

    4.  [**19.4.** Option](../../std/option.html)

    5.  [**19.5.** Result](../../std/result.html)[]{.toggle}

        <div>

        ❱

        </div>

    6.  1.  [**19.5.1.** ?](../../std/result/question_mark.html)

    7.  [**19.6.** panic!](../../std/panic.html)

    8.  [**19.7.** ハッシュマップ](../../std/hash.html)[]{.toggle}

        <div>

        ❱

        </div>

    9.  1.  [**19.7.1.** key型の変種](../../std/hash/alt_key_types.html)
        2.  [**19.7.2.** ハッシュ集合](../../std/hash/hashset.html)

    10. [**19.8.** Rc](../../std/rc.html)

    11. [**19.9.** Arc](../../std/arc.html)

39. [**20.** 標準ライブラリのその他](../../std_misc.html)[]{.toggle}

    <div>

    ❱

    </div>

40. 1.  [**20.1.** スレッド](../../std_misc/threads.html)[]{.toggle}

        <div>

        ❱

        </div>

    2.  1.  [**20.1.1.** Testcase:
            map-reduce](../../std_misc/threads/testcase_mapreduce.html)

    3.  [**20.2.** チャネル](../../std_misc/channels.html)

    4.  [**20.3.** Path](../../std_misc/path.html)

    5.  [**20.4.** ファイル I/O](../../std_misc/file.html)[]{.toggle}

        <div>

        ❱

        </div>

    6.  1.  [**20.4.1.** open](../../std_misc/file/open.html)
        2.  [**20.4.2.** create](../../std_misc/file/create.html)
        3.  [**20.4.3.** read
            lines](../../std_misc/file/read_lines.html)

    7.  [**20.5.** 子プロセス](../../std_misc/process.html)[]{.toggle}

        <div>

        ❱

        </div>

    8.  1.  [**20.5.1.** パイプ](../../std_misc/process/pipe.html)
        2.  [**20.5.2.** dropの延期](../../std_misc/process/wait.html)

    9.  [**20.6.** ファイルシステムとのやり取り](../../std_misc/fs.html)

    10. [**20.7.** 引数処理](../../std_misc/arg.html)[]{.toggle}

        <div>

        ❱

        </div>

    11. 1.  [**20.7.1.** 引数のパース](../../std_misc/arg/matching.html)

    12. [**20.8.** 他言語関数インターフェイス](../../std_misc/ffi.html)

41. [**21.** Testing](../../testing.html)[]{.toggle}

    <div>

    ❱

    </div>

42. 1.  [**21.1.** Unit testing](../../testing/unit_testing.html)
    2.  [**21.2.** Documentation
        testing](../../testing/doc_testing.html)
    3.  [**21.3.** Integration
        testing](../../testing/integration_testing.html)
    4.  [**21.4.**
        Dev-dependencies](../../testing/dev_dependencies.html)

43. [**22.** 安全でない操作](../../unsafe.html)

44. [**23.** Compatibility](../../compatibility.html)[]{.toggle}

    <div>

    ❱

    </div>

45. 1.  [**23.1.** Raw
        identifiers](../../compatibility/raw_identifiers.html)

46. [**24.** 周辺情報](../../meta.html)[]{.toggle}

    <div>

    ❱

    </div>

47. 1.  [**24.1.** ドキュメンテーション](../../meta/doc.html)
    2.  [**24.2.** Playpen](../../meta/playpen.html)
:::

::: {#sidebar-resize-handle .sidebar-resize-handle}
:::

::: {#page-wrapper .page-wrapper}
::: page
::: {#menu-bar-hover-placeholder}
:::

::: {#menu-bar .menu-bar .sticky .bordered}
::: left-buttons

-   Light (default)
-   Rust
-   Coal
-   Navy
-   Ayu
:::

# Rust By Example 日本語版 {#rust-by-example-日本語版 .menu-title}

::: right-buttons
[](../../print.html "Print this book")
[](https://github.com/rust-lang-ja/rust-by-example-ja "Git repository")
:::
:::

::: {#search-wrapper .hidden}
::: {#searchresults-outer .searchresults-outer .hidden}
::: {#searchresults-header .searchresults-header}
:::
:::
:::

::: {#content .content}
::: {role="main"}
# [エラー型を定義する](#エラー型を定義する){.header}

異なるエラー型をマスクし単一のエラー型として扱えるようにすると、コードがシンプルになる場合があります。ここでは自前のエラー型でそれを示してみます。

Rustはユーザーによる新たなエラー型の定義をサポートします。一般に「良い」エラー型は、

-   異なるエラーをまとめて同じ型として扱う
-   ユーザーに優しいエラーメッセージを提供する
-   他の型との比較を楽にする
    -   良い例：`Err(EmptyVec)`
    -   悪い例：`Err("Please use a vector with at least one element".to_owned())`
-   エラーについての情報を保持できる
    -   良い例：`Err(BadChar(c, position))`
    -   悪い例：`Err("+ cannot be used here".to_owned())`
-   他のエラーと問題なく連携できる

```{=html}
<!-- -->
```
    use std::error;
    use std::fmt;

    type Result<T> = std::result::Result<T, DoubleError>;

    // Define our error types. These may be customized for our error handling cases.
    // Now we will be able to write our own errors, defer to an underlying error
    // implementation, or do something in between.
    // 自前のエラー型の定義。エラーハンドリングのケースの応じてカスタマイズされる。
    // ここで新たなエラーを書くことができ、元のエラーの実装に処理を委譲したり、
    // その手前で何らかの処理を挟むことができます。
    #[derive(Debug, Clone)]
    struct DoubleError;

    // Generation of an error is completely separate from how it is displayed.
    // There's no need to be concerned about cluttering complex logic with the display style.
    // エラーの生成は、それがどのように表示されるかとは別物です。
    // そのため、エラーの表示スタイルに関する複雑なロジックを煩雑になるなどと気にする必要はありません。
    //
    // Note that we don't store any extra info about the errors. This means we can't state
    // which string failed to parse without modifying our types to carry that information.
    // エラーに関する余分な情報を持たせていないことに注意してください。
    // どの文字列がパースに失敗したかなどを出力することは、
    // その情報を保持させるようにエラーの定義を修正しない限りできません。
    impl fmt::Display for DoubleError {
        fn fmt(&self, f: &mut fmt::Formatter) -> fmt::Result {
            write!(f, "invalid first item to double")
        }
    }

    // This is important for other errors to wrap this one.
    impl error::Error for DoubleError {
        fn source(&self) -> Option<&(dyn error::Error + 'static)> {
            // Generic error, underlying cause isn't tracked.
            // 基本となるエラー、原因は記録されていない。
            None
        }
    }

    fn double_first(vec: Vec<&str>) -> Result<i32> {
        vec.first()
            // Change the error to our new type.
            // エラーを新たな型に変更する。
            .ok_or(DoubleError)
            .and_then(|s| {
                s.parse::<i32>()
                    // Update to the new error type here also.
                    // ここでも新たなエラー型に更新する。
                    .map_err(|_| DoubleError)
                    .map(|i| 2 * i)
            })
    }

    fn print(result: Result<i32>) {
        match result {
            Ok(n) => println!("The first doubled is {}", n),
            Err(e) => println!("Error: {}", e),
        }
    }

    fn main() {
        let numbers = vec!["42", "93", "18"];
        let empty = vec![];
        let strings = vec!["tofu", "93", "18"];

        print(double_first(numbers));
        print(double_first(empty));
        print(double_first(strings));
    }
:::

