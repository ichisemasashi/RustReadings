## スレッドをまたいだ共有

`Mutex` はスマートポインタによって一般的に保持されるコンテナデータ構造で、データを取り込み、その中のデータへのミュータブル参照とイミュータブル参照を借用することができます。これは、オペレーティングシステムが、一度に1つのCPUスレッドだけがデータにアクセスできるように制限し、そのスレッドがロックされた借用を終えるまで他のスレッドをブロックすることで、借用が悪用されるのを防ぐことができます。

マルチスレッドは Tour of Rust の対象外ですが、 `Mutex` は、複数の CPU スレッドが同じデータにアクセスするのを制御するための基本的な部分です。

特別なスマートポインタ `Arc` があり、これは `Rc` と同じだが、スレッドセーフな参照カウントのインクリメントを使用する。これは、同じ `Mutex` に多くの参照を持たせるためによく使用されます。

```
use std::sync::Mutex;

struct Pie;

impl Pie {
    fn eat(&self) {
        println!("only I eat the pie right now!");
    }
}

fn main() {
    let mutex_pie = Mutex::new(Pie);
    // pieのロックされた不変のリファレンスを借りましょう。
    // ロックの結果をアンラップする必要があります。
    // 失敗する可能性があるからです。
    let ref_pie = mutex_pie.lock().unwrap();
    ref_pie.eat();
    // ロックされた参照はここで落ち、mutexで保護された値は他の人が使うことができる。
}
```